(()=>{var t,e,i,s,r={2197:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(7537),r=i.n(s),n=i(3645),a=i.n(n)()(r());a.push([t.id,"html, body {\r\n    margin: 0;\r\n    height: 100%;\r\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n    color: white;\r\n}\r\n\r\nbody {\r\n    height: 100vh;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n#canvas {\r\n    width: 100%;\r\n    height: 100%;\r\n    /* display: block; */\r\n    visibility: hidden;\r\n    top: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    /* width: 1; */\r\n    position: absolute;\r\n}\r\n\r\nmain {\r\n    /* height: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center; */\r\n}\r\n\r\n#uiCanvas {\r\n    /* width: 100%;\r\n    height: 100%; */\r\n    display: block;\r\n\r\n    image-rendering: -moz-crisp-edges;\r\n    image-rendering: -webkit-crisp-edges;\r\n    image-rendering: pixelated;\r\n    image-rendering: crisp-edges;\r\n}\r\n\r\n#ui {\r\n    position: absolute;\r\n    top: 0;\r\n    width: 100vw;\r\n    height: 50px;\r\n    opacity: 0.9;\r\n    background-color: black;\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n\r\n#ui > * {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    min-width: 100px;\r\n}\r\n\r\n#levelEditor {\r\n    background-color: red;\r\n    opacity: 0.9;\r\n    position: absolute;\r\n    bottom: 0px;\r\n    left: 0px;\r\n    border-radius: 5px;\r\n    padding: 10px;\r\n    margin: 5px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    text-align: center;\r\n}\r\n\r\n#levelEditor > * {\r\n    text-decoration: none;\r\n    color: white;\r\n}","",{version:3,sources:["webpack://./src/game/style.css"],names:[],mappings:"AAAA;IACI,SAAS;IACT,YAAY;IACZ,4DAA4D;IAC5D,YAAY;AAChB;;AAEA;IACI,aAAa;IACb,aAAa;IACb,sBAAsB;IACtB,uBAAuB;IACvB,mBAAmB;AACvB;;AAEA;IACI,WAAW;IACX,YAAY;IACZ,oBAAoB;IACpB,kBAAkB;IAClB,MAAM;IACN,SAAS;IACT,OAAO;IACP,QAAQ;IACR,cAAc;IACd,kBAAkB;AACtB;;AAEA;IACI;;;0BAGsB;AAC1B;;AAEA;IACI;mBACe;IACf,cAAc;;IAEd,iCAAiC;IACjC,oCAAoC;IACpC,0BAA0B;IAC1B,4BAA4B;AAChC;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,YAAY;IACZ,YAAY;IACZ,YAAY;IACZ,uBAAuB;IACvB,aAAa;IACb,uBAAuB;AAC3B;;AAEA;IACI,aAAa;IACb,sBAAsB;IACtB,mBAAmB;IACnB,gBAAgB;AACpB;;AAEA;IACI,qBAAqB;IACrB,YAAY;IACZ,kBAAkB;IAClB,WAAW;IACX,SAAS;IACT,kBAAkB;IAClB,aAAa;IACb,WAAW;IACX,aAAa;IACb,uBAAuB;IACvB,mBAAmB;IACnB,kBAAkB;AACtB;;AAEA;IACI,qBAAqB;IACrB,YAAY;AAChB",sourcesContent:["html, body {\r\n    margin: 0;\r\n    height: 100%;\r\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n    color: white;\r\n}\r\n\r\nbody {\r\n    height: 100vh;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n}\r\n\r\n#canvas {\r\n    width: 100%;\r\n    height: 100%;\r\n    /* display: block; */\r\n    visibility: hidden;\r\n    top: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    /* width: 1; */\r\n    position: absolute;\r\n}\r\n\r\nmain {\r\n    /* height: 100%;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center; */\r\n}\r\n\r\n#uiCanvas {\r\n    /* width: 100%;\r\n    height: 100%; */\r\n    display: block;\r\n\r\n    image-rendering: -moz-crisp-edges;\r\n    image-rendering: -webkit-crisp-edges;\r\n    image-rendering: pixelated;\r\n    image-rendering: crisp-edges;\r\n}\r\n\r\n#ui {\r\n    position: absolute;\r\n    top: 0;\r\n    width: 100vw;\r\n    height: 50px;\r\n    opacity: 0.9;\r\n    background-color: black;\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n\r\n#ui > * {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    min-width: 100px;\r\n}\r\n\r\n#levelEditor {\r\n    background-color: red;\r\n    opacity: 0.9;\r\n    position: absolute;\r\n    bottom: 0px;\r\n    left: 0px;\r\n    border-radius: 5px;\r\n    padding: 10px;\r\n    margin: 5px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    text-align: center;\r\n}\r\n\r\n#levelEditor > * {\r\n    text-decoration: none;\r\n    color: white;\r\n}"],sourceRoot:""}]);const o=a},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,r,n){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(s)for(var o=0;o<this.length;o++){var h=this[o][0];null!=h&&(a[h]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);s&&a[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),e.push(c))}},e}},7537:t=>{"use strict";t.exports=function(t){var e=t[1],i=t[3];if(!i)return e;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),n="/*# ".concat(r," */"),a=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[e].concat(a).concat([n]).join("\n")}return[e].join("\n")}},3379:t=>{"use strict";var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var n={},a=[],o=0;o<t.length;o++){var h=t[o],l=s.base?h[0]+s.base:h[0],c=n[l]||0,u="".concat(l," ").concat(c);n[l]=c+1;var d=i(u),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var m=r(p,s);s.byIndex=o,e.splice(o,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function r(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,r){var n=s(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<n.length;a++){var o=i(n[a]);e[o].references--}for(var h=s(t,r),l=0;l<n.length;l++){var c=i(n[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}n=h}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},9216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,r&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},442:(t,e,i)=>{var s={"./1.json":[9244,244],"./test 1.json":[7918,918],"./test 2.json":[345,345]};function r(t){if(!i.o(s,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=s[t],r=e[0];return i.e(e[1]).then((()=>i.t(r,19)))}r.keys=()=>Object.keys(s),r.id=442,t.exports=r},7704:(t,e,i)=>{"use strict";t.exports=i.p+"c28c2d04dba8d7847600.wav"},4112:(t,e,i)=>{"use strict";t.exports=i.p+"4bc62f0c8a564cc1519e.wav"},9421:(t,e,i)=>{"use strict";t.exports=i.p+"cdbe9cd285597a34457d.wav"},7964:(t,e,i)=>{"use strict";t.exports=i.p+"d8bbeb73bea97c64d4ea.wav"},6346:(t,e,i)=>{"use strict";t.exports=i.p+"a8f7d72de2d0a816f233.wav"},8964:(t,e,i)=>{"use strict";t.exports=i.p+"772668b5639d2cf25760.wav"},9420:(t,e,i)=>{"use strict";t.exports=i.p+"e0581588b09dd0900754.wav"},3185:(t,e,i)=>{"use strict";t.exports=i.p+"d7866eb0acc69091f7be.wav"},1491:(t,e,i)=>{"use strict";t.exports=i.p+"9cd63032bef03f939538.wav"},4452:(t,e,i)=>{"use strict";t.exports=i.p+"05302a5f82dd9352a889.wav"},2551:(t,e,i)=>{"use strict";t.exports=i.p+"fc182771a34fc9229f84.wav"},1559:(t,e,i)=>{"use strict";t.exports=i.p+"909b1b50aec6f4d75ba6.wav"},6217:(t,e,i)=>{"use strict";t.exports=i.p+"44cf9541822c7396a8d1.wav"},8077:(t,e,i)=>{"use strict";t.exports=i.p+"b1e554c684727298e9ef.wav"},6919:(t,e,i)=>{"use strict";t.exports=i.p+"e1b1489aeb1c8dcc58ba.wav"},2759:(t,e,i)=>{"use strict";t.exports=i.p+"887381e1b1a6f32b972c.wav"},756:(t,e,i)=>{"use strict";t.exports=i.p+"863c2e413697a79a12b4.wav"},314:(t,e,i)=>{"use strict";t.exports=i.p+"0b8477c3647d5840d0d5.wav"},9613:(t,e,i)=>{"use strict";t.exports=i.p+"9cff80104e897491412d.wav"},6878:(t,e,i)=>{"use strict";t.exports=i.p+"ce6d25eec86d26c37218.wav"},7120:(t,e,i)=>{"use strict";t.exports=i.p+"7ac91f3f1be89e2a3912.wav"},1669:(t,e,i)=>{"use strict";t.exports=i.p+"da7e1781801784a4bfcd.wav"},6213:(t,e,i)=>{"use strict";t.exports=i.p+"e527be317343985f2c25.wav"},1023:(t,e,i)=>{"use strict";t.exports=i.p+"73f1b9a5e8f0063bad1f.wav"},9435:(t,e,i)=>{"use strict";t.exports=i.p+"ee16f1d494f6d3c930af.wav"},5589:(t,e,i)=>{"use strict";t.exports=i.p+"b4bfdb70fdea44eaa28e.wav"},6121:(t,e,i)=>{"use strict";t.exports=i.p+"9c673c700503de9cccb1.wav"},4830:(t,e,i)=>{"use strict";t.exports=i.p+"12a02edb9efca4110568.wav"},933:(t,e,i)=>{"use strict";t.exports=i.p+"ecc12905263676f13ff1.wav"},2764:(t,e,i)=>{"use strict";t.exports=i.p+"b5e15ab9e589d701e383.wav"},6178:(t,e,i)=>{"use strict";t.exports=i.p+"df352bc44554e9909ca0.wav"},9040:(t,e,i)=>{"use strict";t.exports=i.p+"4c744eede1c73b1531d0.wav"},4639:(t,e,i)=>{"use strict";t.exports=i.p+"0798856be04b7b516d00.mp3"},6738:(t,e,i)=>{"use strict";t.exports=i.p+"89bc63f3c1993c915b35.mp3"},1244:(t,e,i)=>{"use strict";t.exports=i.p+"adf30895f1d5849e84e6.mp3"},6020:(t,e,i)=>{"use strict";t.exports=i.p+"dcc62727ab58972dec50.png"},3108:(t,e,i)=>{"use strict";t.exports=i.p+"59a0dcaeec21e573f93a.png"},94:(t,e,i)=>{"use strict";t.exports=i.p+"cbeef861a7af4dfdf3bb.png"},7854:(t,e,i)=>{"use strict";t.exports=i.p+"9a5cf72f7876e057817e.png"},5784:(t,e,i)=>{"use strict";t.exports=i.p+"e0707337899a23d6596e.png"},5455:(t,e,i)=>{"use strict";t.exports=i.p+"08b859c12ea03793442e.png"},4227:(t,e,i)=>{"use strict";t.exports=i.p+"86e3f21485fc4b4f61b5.png"},2685:(t,e,i)=>{"use strict";t.exports=i.p+"c863487f6efc56062e44.png"},8798:(t,e,i)=>{"use strict";t.exports=i.p+"11864b99536145f3422d.png"},3207:(t,e,i)=>{"use strict";t.exports=i.p+"f7ec45bb1d54ccdc48be.png"},2268:(t,e,i)=>{"use strict";t.exports=i.p+"8df8baa303f23c8c5138.png"},877:(t,e,i)=>{"use strict";t.exports=i.p+"6dc7bc397e0ff6b17945.png"},4381:(t,e,i)=>{"use strict";t.exports=i.p+"6d0a11395abdea07b59a.png"}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={id:t,exports:{}};return r[t](i,i.exports,a),i.exports}a.m=r,a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var r=Object.create(null);a.r(r);var n={};t=t||[null,e({}),e([]),e(e)];for(var o=2&s&&i;"object"==typeof o&&!~t.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach((t=>n[t]=()=>i[t]));return n.default=()=>i,a.d(r,n),r},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,i)=>(a.f[i](t,e),e)),[])),a.u=t=>t+".bundle_"+{244:"d7b103709ce9f074d1b5",345:"0848b24577dca9d5e4e6",918:"bc55be310ccd27075c00"}[t]+".js",a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},s="wolfenstein:",a.l=(t,e,r,n)=>{if(i[t])i[t].push(e);else{var o,h;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==s+r){o=u;break}}o||(h=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",s+r),o.src=t),i[t]=[e];var d=(e,s)=>{o.onerror=o.onload=null,clearTimeout(p);var r=i[t];if(delete i[t],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((t=>t(s))),e)return e(s)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),h&&document.head.appendChild(o)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.p="/",(()=>{var t={757:0};a.f.j=(e,i)=>{var s=a.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var r=new Promise(((i,r)=>s=t[e]=[i,r]));i.push(s[2]=r);var n=a.p+a.u(e),o=new Error;a.l(n,(i=>{if(a.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var r=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;o.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",o.name="ChunkLoadError",o.type=r,o.request=n,s[1](o)}}),"chunk-"+e,e)}};var e=(e,i)=>{var s,r,[n,o,h]=i,l=0;if(n.some((e=>0!==t[e]))){for(s in o)a.o(o,s)&&(a.m[s]=o[s]);h&&h(a)}for(e&&e(i);l<n.length;l++)r=n[l],a.o(t,r)&&t[r]&&t[r][0](),t[n[l]]=0},i=self.webpackChunkwolfenstein=self.webpackChunkwolfenstein||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{"use strict";var t=a(3379),e=a.n(t),i=a(7795),s=a.n(i),r=a(569),n=a.n(r),o=a(3565),h=a.n(o),l=a(9216),c=a.n(l),u=a(4589),d=a.n(u),p=a(2197),m={};m.styleTagTransform=d(),m.setAttributes=h(),m.insert=n().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=c(),e()(p.Z,m),p.Z&&p.Z.locals&&p.Z.locals;class f{constructor(t,e,i){this.gl=t;const s=this.createShader(t,t.VERTEX_SHADER,e),r=this.createShader(t,t.FRAGMENT_SHADER,i);this.program=this.createProgram(t,s,r)}use(){this.gl.useProgram(this.program)}attribute(t){return this.gl.getAttribLocation(this.program,t)}uniform(t){return this.gl.getUniformLocation(this.program,t)}createShader(t,e,i){const s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;t.deleteShader(s)}createProgram(t,e,i){const s=t.createProgram();if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))return s;t.deleteProgram(s)}}class g extends f{constructor(t){super(t,"attribute vec4 a_position;\r\nattribute vec4 a_color;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main() {\r\n  gl_Position = u_matrix * a_position;    \r\n  // Pass the color to the fragment shader.\r\n  v_color = a_color;\r\n}","precision mediump float;\r\n\r\n// Passed in from the vertex shader.\r\nvarying vec4 v_color;\r\n\r\nvoid main() {\r\n   gl_FragColor = v_color;\r\n}"),this.info={attributes:{position:this.attribute("a_position"),color:this.attribute("a_color")},uniforms:{matrix:this.uniform("u_matrix")}}}}class x extends f{constructor(t){super(t,"attribute vec4 a_position;\r\nattribute vec2 a_texcoord;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvarying vec2 v_texcoord;\r\n\r\nvoid main() {\r\n  gl_Position = u_matrix * a_position;    \r\n  \r\n  // Pass the texcoord to the fragment shader.\r\n  v_texcoord = a_texcoord;\r\n}","precision mediump float;\r\n\r\n// Passed in from the vertex shader.\r\nvarying vec2 v_texcoord;\r\n\r\n// The texture.\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    vec4 texColor = texture2D(u_texture, v_texcoord);\r\n    if(texColor.a < 0.1)\r\n        discard;\r\n    gl_FragColor = texColor;\r\n    // gl_FragColor = texture2D(u_texture, v_texcoord);\r\n}"),this.info={attributes:{position:this.attribute("a_position"),texcoord:this.attribute("a_texcoord")},uniforms:{matrix:this.uniform("u_matrix")}}}loadTexture(t,e){const i=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var s=new Image;s.src=t,s.addEventListener("load",(()=>{e()}))}}function y(t){return 180*t/Math.PI}function w(t){return t*Math.PI/180}const S={translation:t=>[1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1],get identity(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},rotate:(t,e)=>{let i=S.multiply(t,S.xRotation(e.x));return i=S.multiply(i,S.yRotation(e.y)),i=S.multiply(i,S.zRotation(e.z)),i},xRotation:t=>{const e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]},yRotation:t=>{const e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]},zRotation:t=>{const e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]},scaling:t=>[t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1],translate:(t,e)=>S.multiply(t,S.translation(e)),xRotate:(t,e)=>S.multiply(t,S.xRotation(e)),yRotate:(t,e)=>S.multiply(t,S.yRotation(e)),zRotate:(t,e)=>S.multiply(t,S.zRotation(e)),scale:(t,e)=>S.multiply(t,S.scaling(e)),perspective:(t,e,i,s)=>{var r=Math.tan(.5*Math.PI-.5*t),n=1/(i-s);return[r/e,0,0,0,0,r,0,0,0,0,(i+s)*n,-1,0,0,i*s*n*2,0]},makeZToWMatrix:t=>[1,0,0,0,0,1,0,0,0,0,1,t,0,0,0,1],multiply:(t,e)=>{const i=t[0],s=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],m=t[12],f=t[13],g=t[14],x=t[15],y=e[0],w=e[1],S=e[2],b=e[3],v=e[4],A=e[5],T=e[6],z=e[7],C=e[8],I=e[9],P=e[10],R=e[11],k=e[12],L=e[13],D=e[14],B=e[15];return[i*y+s*v+r*C+n*k,i*w+s*A+r*I+n*L,i*S+s*T+r*P+n*D,i*b+s*z+r*R+n*B,a*y+o*v+h*C+l*k,a*w+o*A+h*I+l*L,a*S+o*T+h*P+l*D,a*b+o*z+h*R+l*B,c*y+u*v+d*C+p*k,c*w+u*A+d*I+p*L,c*S+u*T+d*P+p*D,c*b+u*z+d*R+p*B,m*y+f*v+g*C+x*k,m*w+f*A+g*I+x*L,m*S+f*T+g*P+x*D,m*b+f*z+g*R+x*B]},multiplyScalar:(t,e)=>t.map((t=>t*e)),det:t=>{const e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15];return e*a*u*g+e*o*d*m+e*h*c*f+ +i*n*d*f+i*o*l*g+i*h*u*p+ +s*n*c*g+s*a*d*p+s*h*l*m+ +r*n*u*m+r*a*l*f+r*o*c*p+-e*a*d*f-e*o*c*g-e*h*u*m+-i*n*u*g-i*o*d*p-i*h*l*f+-s*n*d*m-s*a*l*g-s*h*c*p+-r*n*c*f-r*a*u*p-r*o*l*m},inverse(t){let e=new Array(16);var i=t[0],s=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],m=t[12],f=t[13],g=t[14],x=t[15],y=d*x,w=g*p,S=h*x,b=g*l,v=h*p,A=d*l,T=r*x,z=g*n,C=r*p,I=d*n,P=r*l,R=h*n,k=c*f,L=m*u,D=a*f,B=m*o,E=a*u,M=c*o,_=i*f,F=m*s,N=i*u,O=c*s,U=i*o,j=a*s,W=y*o+b*u+v*f-(w*o+S*u+A*f),V=w*s+T*u+I*f-(y*s+z*u+C*f),G=S*s+z*o+P*f-(b*s+T*o+R*f),Z=A*s+C*o+R*u-(v*s+I*o+P*u),q=1/(i*W+a*V+c*G+m*Z);return e[0]=q*W,e[1]=q*V,e[2]=q*G,e[3]=q*Z,e[4]=q*(w*a+S*c+A*m-(y*a+b*c+v*m)),e[5]=q*(y*i+z*c+C*m-(w*i+T*c+I*m)),e[6]=q*(b*i+T*a+R*m-(S*i+z*a+P*m)),e[7]=q*(v*i+I*a+P*c-(A*i+C*a+R*c)),e[8]=q*(k*l+B*p+E*x-(L*l+D*p+M*x)),e[9]=q*(L*n+_*p+O*x-(k*n+F*p+N*x)),e[10]=q*(D*n+F*l+U*x-(B*n+_*l+j*x)),e[11]=q*(M*n+N*l+j*p-(E*n+O*l+U*p)),e[12]=q*(D*d+M*g+L*h-(E*g+k*h+B*d)),e[13]=q*(N*g+k*r+F*d-(_*d+O*g+L*r)),e[14]=q*(_*h+j*g+B*r-(U*g+D*r+F*h)),e[15]=q*(U*d+E*r+O*h-(N*h+j*d+M*r)),e},lookAt:function(t,e){var i=t.substract(e).normalize,s=v.up.cross(i).normalize,r=i.cross(s).normalize;return[s.x,s.y,s.z,0,r.x,r.y,r.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,1]},getPositionVector:function(t){return new v(t[12],t[13],t[14]).map((t=>t<1e-7?0:t))},getScaleVector:function(t){return new v(new v(t[0],t[4],t[8]).magnitude,new v(t[1],t[5],t[9]).magnitude,new v(t[2],t[6],t[10]).magnitude)},getRotationMatrix:function(t){const e=S.getScaleVector(t);return[t[0]/e.x,t[1]/e.y,t[2]/e.z,0,t[4]/e.x,t[5]/e.y,t[6]/e.z,0,t[8]/e.x,t[9]/e.y,t[10]/e.z,0,0,0,0,1]}};class b{constructor(t,e){this.set(t,e)}static arrayToVec2Array(t){let e=[];for(let i=0;i<t.length;i+=2)e.push(new b(t[i],t[i+1]));return e}static vec2ArrayToArray(t){let e=[];for(let i of t)e.push(i.x,i.y);return e}set(t,e){this.x=t,this.y=e}multiply(t){return new b(this.x*t,this.y*t)}add(t){return new b(this.x+t.x,this.y+t.y)}map(t){return new b(t(this.x),t(this.y))}multiplyByVector(t){return new b(this.x*t.x,this.y*t.y)}substract(t){return new b(this.x-t.x,this.y-t.y)}get abs(){return this.map((t=>Math.abs(t)))}equals(t){return this.x==t.x&&this.y==t.y}toVec3(){return new v(this.x,0,this.y)}}class v{constructor(t,e,i){this.set(t,e,i)}static get one(){return new v(1,1,1)}static get zero(){return new v(0,0,0)}static get forward(){return new v(0,0,1)}static get backward(){return new v(0,0,-1)}static get right(){return new v(1,0,0)}static get left(){return new v(-1,0,0)}static get up(){return new v(0,1,0)}static get down(){return new v(0,-1,0)}static arrayToVec3Array(t){let e=[];for(let i=0;i<t.length;i+=3)e.push(new v(t[i],t[i+1],t[i+2]));return e}static vec3ArrayToArray(t){let e=[];for(let i of t)e.push(i.x,i.y,i.z);return e}set(t,e,i){this.x=t,this.y=e,this.z=i}get copy(){return new v(this.x,this.y,this.z)}get xInverted(){return new v(-this.x,this.y,this.z)}get yInverted(){return new v(this.x,-this.y,this.z)}get zInverted(){return new v(this.x,this.y,-this.z)}multiply(t){return new v(this.x*t,this.y*t,this.z*t)}multiplyByVector(t){return new v(this.x*t.x,this.y*t.y,this.z*t.z)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}isGreater(t){return this.x>=t.x&&this.y>=t.y&&this.z>=t.z&&(this.x>t.x||this.y>t.y||this.z>t.z)}isLess(t){return this.x<=t.x&&this.y<=t.y&&this.z<=t.z&&(this.x<t.x||this.y<t.y||this.z<t.z)}cross(t){return new v(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}add(t){return new v(this.x+t.x,this.y+t.y,this.z+t.z)}substract(t){return new v(this.x-t.x,this.y-t.y,this.z-t.z)}distanceTo(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2)+Math.pow(t.z-this.z,2))}horizontalDistanceTo(t){return this.yZeroed.distanceTo(t.yZeroed)}to(t){return new v(t.x-this.x,t.y-this.y,t.z-this.z)}get inverted(){return this.multiply(-1)}get normalize(){if(0!=this.magnitude){const t=1/this.magnitude;return this.multiply(t)}return v.zero}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}transformMat4(t){var e=t[3]*this.x+t[7]*this.y+t[11]*this.z+t[15];e=e||1;let i=v.zero;return i.x=(t[0]*this.x+t[4]*this.y+t[8]*this.z+t[12])/e,i.y=(t[1]*this.x+t[5]*this.y+t[9]*this.z+t[13])/e,i.z=(t[2]*this.x+t[6]*this.y+t[10]*this.z+t[14])/e,i}clone(){return new v(this.x,this.y,this.z)}static fromAngle(t){return t+=3*Math.PI/2,new v(Math.cos(t),0,Math.sin(t))}map(t){return new v(t(this.x),t(this.y),t(this.z))}get yZeroed(){return new v(this.x,0,this.z)}get abs(){return this.map((t=>Math.abs(t)))}get minusOneOrZeroOrOne(){return this.map((t=>t>0?1:t<0?-1:0))}toVec2(){return new b(this.x,this.z)}}class A{constructor(){this.position=v.zero,this.rotation=v.zero,this.scale=v.one,this.originTranslation=v.zero}reset(){this.position=v.zero,this.rotation=v.zero,this.scale=v.one}get matrix(){let t=S.identity;t=S.scale(t,this.scale),t=S.xRotate(t,this.rotation.x),t=S.yRotate(t,this.rotation.y),t=S.zRotate(t,this.rotation.z);const e=this.position.add(this.originTranslation);return t=S.translate(t,e),t}clone(){const t=new A;return t.position=this.position.clone(),t.rotation=this.rotation.clone(),t.scale=this.scale.clone(),t}}class T{constructor(t,e){this.firstBufferReady=!1,this.transform=new A,this.bb=null,this.texturedWidth=1,this.gl=t,this.program=e,setTimeout((()=>{this.updateBuffers()}))}get verticesTransformed(){return this.verticesVec3Array.map((t=>{let e=S.identity;return e=S.translate(e,t.multiplyByVector(this.transform.scale)),e=S.rotate(e,this.transform.rotation),e=S.translate(this.transform.matrix,S.getPositionVector(e)),S.getPositionVector(e)}))}get verticesCount(){return this.VERTICES.length/3}get verticesVec3Array(){return v.arrayToVec3Array(this.VERTICES)}get xVertices(){return this.VERTICES.filter(((t,e)=>e%3==0))}get yVertices(){return this.VERTICES.filter(((t,e)=>e%3==1))}get zVertices(){return this.VERTICES.filter(((t,e)=>e%3==2))}get size(){return new v((Math.max(...this.xVertices)-Math.min(...this.xVertices))*this.transform.scale.x,(Math.max(...this.yVertices)-Math.min(...this.yVertices))*this.transform.scale.y,(Math.max(...this.zVertices)-Math.min(...this.zVertices))*this.transform.scale.z)}get sizeRotated(){if(!this.transform.rotation.y)return this.size;const t=S.yRotation(this.transform.rotation.y);return this.size.transformMat4(t).abs}get halfSize(){return this.size.multiply(.5)}get halfSizeRotated(){return this.sizeRotated.multiply(.5)}get texturedSize(){return this.size.multiplyByVector(v.right.multiply(this.texturedWidth))}setInitialState(){this.initialTransform=this.transform.clone(),this.initialTexcoords=this.TEXCOORDS.slice(0),this.onCreation(),this.updateBuffers()}onCreation(){}updateBuffers(){this.firstBufferReady||(this.setPositionBuffer(),this.setColorBuffer()),this.TEXCOORDS&&this.setTexcoordsBuffer(),this.firstBufferReady=!0}bindGeometry(t){this.gl.enableVertexAttribArray(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);const e=this.gl.FLOAT;this.gl.vertexAttribPointer(t,3,e,!1,0,0)}bindColors(t){this.gl.enableVertexAttribArray(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer);const e=this.gl.UNSIGNED_BYTE;this.gl.vertexAttribPointer(t,3,e,!0,0,0)}bindTexture(t){this.gl.enableVertexAttribArray(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordsBuffer);const e=this.gl.FLOAT;this.gl.vertexAttribPointer(t,2,e,!1,0,0)}bindTransform(t,e){let i=this.transform.matrix;i=S.multiply(i,e),this.gl.uniformMatrix4fv(t,!1,i)}draw(t){this.firstBufferReady&&(this.program.use(),this.bindGeometry(this.program.info.attributes.position),this.program.info.attributes.color&&this.bindColors(this.program.info.attributes.color),this.program.info.attributes.texcoord&&this.bindTexture(this.program.info.attributes.texcoord),this.bindTransform(this.program.info.uniforms.matrix,t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.webglTexture),this._draw())}_draw(){const t=this.gl.TRIANGLES,e=this.verticesCount;this.gl.drawArrays(t,0,e)}setPositionBuffer(){this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.VERTICES,this.gl.STATIC_DRAW)}setColorBuffer(){this.colorBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.COLORS,this.gl.STATIC_DRAW)}setTexcoordsBuffer(){this.texcoordsBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordsBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.TEXCOORDS,this.gl.STATIC_DRAW)}}class z{constructor(t){this.shape=t,this.transform=t.transform}get vertices(){return this.shape.verticesTransformed}get size(){return this.shape.size}get sizeRotated(){return this.shape.sizeRotated}get halfSize(){return this.shape.halfSize}get halfSizeRotated(){return this.shape.halfSizeRotated}get negativeCorner(){return this.transform.position.substract(this.halfSize)}get negativeCornerRotated(){return this.transform.position.substract(this.halfSizeRotated)}get positiveCorner(){return this.transform.position.add(this.halfSize)}get positiveCornerRotated(){return this.transform.position.add(this.halfSizeRotated)}isColliding(t){const e=this.positiveCornerRotated,i=this.negativeCornerRotated;return i.x<=t.x&&t.x<=e.x&&i.z<=t.z&&t.z<=e.z}pointSide(t){const e=this.transform.position.substract(t);let i=v.zero;return e.x>this.halfSizeRotated.x&&(i.x=-1),e.x<-this.halfSizeRotated.x&&(i.x=1),e.z>this.halfSizeRotated.z&&(i.z=-1),e.z<-this.halfSizeRotated.z&&(i.z=1),i}nearestDistanceDirection(t){const e=this.pointSide(t);return e.x&&e.z?t.substract(this.nearestCorner(t)).yZeroed.normalize:e}pointSideRotated(t){const e=this.pointSide(t),i=S.yRotation(-this.transform.rotation.y);return e.transformMat4(i)}pointFarthestSideRotated(t){const e=this.pointFarthestSide(t),i=S.yRotation(-this.transform.rotation.y);return e.transformMat4(i)}pointFarthestSide(t){const e=this.transform.position.substract(t),i=S.yRotation(this.transform.rotation.y),s=e.transformMat4(i);let r=this.pointSide(t);return r.x&&r.z&&(Math.abs(s.x)>Math.abs(s.z)?r.z=0:r.x=0),r}nearestCorner(t){const e=this.transform.position.substract(t);if(e.x<=0&&e.z<=0)return this.transform.position.substract(this.halfSizeRotated);if(e.x<=0&&e.z>=0){const t=new v(-this.halfSizeRotated.x,0,this.halfSizeRotated.z);return this.transform.position.substract(t)}if(e.x>=0&&e.z<=0){const t=new v(this.halfSizeRotated.x,0,-this.halfSizeRotated.z);return this.transform.position.substract(t)}return e.x>=0&&e.z>=0?this.transform.position.add(this.halfSizeRotated):void 0}basePointsYZeroed(){const t=this.halfSizeRotated.yZeroed;return[this.transform.position.add(t),this.transform.position.add(t.xInverted),this.transform.position.add(t.yInverted),this.transform.position.substract(t)]}}class C extends T{constructor(){super(...arguments),this.VERTICES=new Float32Array([-.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),this.COLORS=new Uint8Array([80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,200,70,.52,200,70,.52,200,70,.52,200,70,.52,200,70,.52,200,70,.52,70,200,20.5,70,200,20.5,70,200,20.5,70,200,20.5,70,200,20.5,70,200,20.5,200,200,70,200,200,70,200,200,70,200,200,70,200,200,70,200,200,70,20.5,.5,70,20.5,.5,70,20.5,.5,70,20.5,.5,70,20.5,.5,70,20.5,.5,70,20.5,.56,70,20.5,.56,70,20.5,.56,70,20.5,.56,70,20.5,.56,70,20.5,.56,70]),this.TEXCOORDS=new Float32Array([0,1,1,0,0,0,0,1,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,1,0,1,1,0,0,0]),this.bb=new z(this),this.defaultColors=this.COLORS,this.texturesInLine=1}onCreation(){this.setTexture(0)}setColor(t,e){this.COLORS=new Uint8Array([...this.COLORS.slice(0,18*t),e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],...this.COLORS.slice(18*(t+1))])}wallTexcoords(t){return this.TEXCOORDS.slice(12*t,12*(t+1))}initialWallTexcoords(t){return this.initialTexcoords.slice(12*t,12*(t+1))}resetColor(){this.COLORS=this.defaultColors}get textureSize(){return 1/this.texturesInLine}setTexture(t,e){let i=[];if(void 0!==e)for(let s=0;s<6;s++)s==e?i.push(...this.setTexcoordsToTexture(t,this.initialWallTexcoords(e))):i.push(...this.wallTexcoords(s));else i=[...this.setTexcoordsToTexture(t,this.initialTexcoords)];this.TEXCOORDS=new Float32Array(i)}setTexcoordsToTexture(t,e){let i=b.arrayToVec2Array(e);const s=new b(t%this.texturesInLine,Math.floor(t/this.texturesInLine)).multiply(this.textureSize);return i=i.map((t=>t.multiply(this.textureSize).add(s))),b.vec2ArrayToArray(i)}}var I=a(877);const P={gridSize:64,uiScale:2,debug:!1,soundVolume:.05,musicVolume:.03};var R=a(756),k=a(2759);class L{constructor(t,e){this.playLoading=!1,this.audio=new Audio(t),this.name=t,this.audio.volume=e||P.soundVolume}play(){this.audio.currentTime=0,this.playLoading=!0,this.playPromise=this.audio.play(),this.playPromise.then((()=>this.playLoading=!1))}playIfNotPlayed(){0==this.audio.currentTime&&(this.playLoading=!0,this.playPromise=this.audio.play(),this.playPromise.then((()=>this.playLoading=!1)))}pause(){this.playLoading?this.playPromise.then((()=>this.audio.pause())):this.audio.pause()}loop(){this.audio.loop=!0}}class D extends C{constructor(t,e,i){super(t,e),this.importedTexture=I,this.openAudio=new L(R),this.closeAudio=new L(k),this.opening=!1,this.closing=!1,this.openingSpeed=P.gridSize,this.openingLength=P.gridSize,this.hiddenInWallScaleCorrection=new v(.1,.1,0),this.texturesInLine=16,this.TEXCOORDS=new Float32Array([0,1,1,0,0,0,0,1,1,1,1,0,0,1,0,0,1,0,0,1,1,0,1,1,0,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,1,0,1,1,0,0,0]),this.transform.scale=new v(P.gridSize,P.gridSize,6*P.gridSize/64),this.type=i}get lightTexture(){return"exitDoor"===this.type?119:104}get lightSideTexture(){return"exitDoor"===this.type?119:108}get darkTexture(){return"exitDoor"===this.type?119:105}get darkSideTexture(){return"exitDoor"===this.type?119:109}onCreation(){const t=new v(this.openingLength,0,0);let e=S.identity;e=S.translate(e,t),e=S.yRotate(e,this.transform.rotation.y);const i=S.getPositionVector(e);this.positionFinal=this.initialTransform.position.add(i),this.transform.rotation.y?(this.setTexture(this.darkTexture),this.setTexture(this.lightSideTexture,2),this.setTexture(this.lightSideTexture,3)):(this.setTexture(this.lightTexture),this.setTexture(this.darkSideTexture,2),this.setTexture(this.darkSideTexture,3))}update(t){const e=new v(this.openingSpeed*t,0,0);let i=S.identity;i=S.translate(i,e),i=S.yRotate(i,this.transform.rotation.y);const s=S.getPositionVector(i);this.opening?this.transform.position.equals(this.positionFinal)?(this.opening=!1,this.initialTransform.scale.equals(this.transform.scale)&&(this.transform.scale=this.transform.scale.substract(this.hiddenInWallScaleCorrection))):this.positionFinal.substract(this.transform.position).isLess(s)?this.transform.position=this.positionFinal.clone():this.transform.position=this.transform.position.add(s):this.closing&&(this.transform.position.equals(this.initialTransform.position)?this.closing=!1:this.transform.position.substract(this.initialTransform.position).isLess(s)?this.transform.position=this.initialTransform.position.clone():this.transform.position=this.transform.position.substract(s))}get closed(){return this.transform.position.equals(this.initialTransform.position)}get opened(){return this.transform.position.equals(this.positionFinal)}toggle(){this.closed?(this.closing=!1,this.opening=!0,this.openAudio.play()):this.opened&&(this.transform.scale.add(this.hiddenInWallScaleCorrection).equals(this.initialTransform.scale)&&(this.transform.scale=this.transform.scale.add(this.hiddenInWallScaleCorrection)),this.opening=!1,this.closing=!0,this.closeAudio.play())}get canInteract(){return this.closed}tryToClose(t,e,i){[e,...i].every((t=>t.transform.position.yZeroed.distanceTo(this.initialTransform.position.yZeroed)>2*P.gridSize))&&this.opened&&this.toggle()}}var B=a(8798),E=a(3207),M=a(2685),_=a(5455),F=a(7854),N=a(5784),O=a(7964),U=a(6346),j=a(9421);class W{constructor(){this.audioSelect=new L(U),this.audioMove=new L(O),this.audioBack=new L(j),this.option=0,this.timeSinceLastBlink=0,this.timeSinceBlinkStart=0,this.blinkInterval=1,this.blinkDuration=.1,this.optionSize=new b(300,26),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=640,this.canvas.height=400,this.menuUnselected=new Image,this.menuUnselected.src=_,this.menuSelected=new Image,this.menuSelected.src=F,this.menuSelectedBlink=new Image,this.menuSelectedBlink.src=N,addEventListener("keydown",(t=>{"menu"==at.instance.state&&("ArrowDown"!=t.code&&"ArrowUp"!=t.code||(0==this.option?this.option=8:this.option=0,this.audioMove.play()))}))}update(t){this.ctx.drawImage(this.menuUnselected,0,0);let e=this.menuSelected;this.timeSinceLastBlink+=t,this.timeSinceLastBlink>=this.blinkInterval&&(e=this.menuSelectedBlink),e==this.menuSelectedBlink&&(this.timeSinceBlinkStart+=t,this.timeSinceBlinkStart>=this.blinkDuration&&(this.timeSinceLastBlink=0,this.timeSinceBlinkStart=0)),this.ctx.drawImage(e,150,108+this.option*this.optionSize.y,this.optionSize.x,this.optionSize.y,150,108+this.option*this.optionSize.y,this.optionSize.x,this.optionSize.y)}}var V=a(1244),G=a(6738),Z=a(4639),q=a(94),Y=a(6020);class X{constructor(){this.displayTime="",this.bonusScore=0,this.animation=0,this.enemiesRatio="0",this.secretsRatio="0",this.treasuresRatio="0",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.canvas.width=320,this.canvas.height=200,this.levelEnd=new Image,this.levelEnd.src=q,this.uiElements=new Image,this.uiElements.src=E,this.font=new Image,this.font.src=Y,setInterval((()=>{this.animation=this.animation?0:1}),500)}calculateValues(){at.instance.endTime=new Date;const t=new Date(at.instance.endTime.getTime()-at.instance.startTime.getTime());this.displayTime=t.toTimeString().substring(3,8);const e=90-Math.floor(t.getTime()/1e3);this.bonusScore=500*e,this.enemiesRatio=Math.floor(at.instance.enemiesKilled/at.instance.enemiesCount*100).toString(),this.secretsRatio=Math.floor(at.instance.secretsFound/at.instance.secretsCount*100).toString(),this.treasuresRatio=Math.floor(at.instance.treasuresFound/at.instance.treasuresCount*100).toString();for(let t of[this.enemiesRatio,this.secretsRatio,this.treasuresRatio])"100"==t&&(this.bonusScore+=1e4);at.instance.score+=this.bonusScore}update(t){this.ctx.drawImage(this.levelEnd,0,0),this.ctx.drawImage(this.uiElements,81*this.animation,60,81,87,20,16,81,87),this.drawTime(),this.drawBonusScore(),this.drawRatios()}drawTime(){this.drawDigit(parseInt(this.displayTime[0]),208,80),this.drawDigit(parseInt(this.displayTime[1]),224,80),this.drawDigit(parseInt(this.displayTime[3]),248,80),this.drawDigit(parseInt(this.displayTime[4]),264,80)}drawBonusScore(){this.drawDigit(parseInt(this.bonusScore.toString()[0]),208,56),this.drawDigit(parseInt(this.bonusScore.toString()[1]),224,56),this.drawDigit(parseInt(this.bonusScore.toString()[2]),240,56),this.drawDigit(parseInt(this.bonusScore.toString()[3]),256,56),this.drawDigit(parseInt(this.bonusScore.toString()[4]),272,56)}drawRatios(){for(let t=0;t<this.enemiesRatio.length;t++)this.drawDigit(parseInt(this.enemiesRatio[this.enemiesRatio.length-1-t]),280-16*t,112);for(let t=0;t<this.secretsRatio.length;t++)this.drawDigit(parseInt(this.secretsRatio[this.secretsRatio.length-1-t]),280-16*t,128);for(let t=0;t<this.treasuresRatio.length;t++)this.drawDigit(parseInt(this.treasuresRatio[this.treasuresRatio.length-1-t]),280-16*t,144)}drawDigit(t,e,i){this.ctx.drawImage(this.font,16*t,0,16,16,e,i,16,16)}}class K{constructor(t,e,i,s,r,n,a){this.range=1e6,this.shooting=!1,this.willShoot=!1,this.justShot=!1,this.textureIndex=0,this.type=t,this.fireRate=e,this.damage=i,this.initTextures=s,this.loopTextures=r,this.shootTexture=n,this.audio=new L(a),this.currentTextures=s}get isAutomatic(){return this.loopTextures.length>0}get isTextureLastInit(){return this.textureIndex}get framesCount(){return this.isAutomatic?this.loopTextures.length:this.initTextures.length}getNextTexture(){return this.justShot=!1,this.isAutomatic?this.shooting?this.getNextShootingTexture():this.getNextStoppedShootingTexture():this.willShoot?this.getNextShootingTexture():this.initTextures[0]}getNextShootingTexture(){this.textureIndex++,this.textureIndex>=this.currentTextures.length&&(this.currentTextures==this.initTextures&&this.isAutomatic?this.currentTextures=this.loopTextures:this.willShoot=!1,this.textureIndex=0);const t=this.currentTextures[this.textureIndex];return t==this.shootTexture&&(this.justShot=!0),t}getNextStoppedShootingTexture(){this.currentTextures==this.loopTextures&&(this.currentTextures=this.initTextures,this.textureIndex=this.initTextures.length-1);let t=this.currentTextures[this.textureIndex];return this.textureIndex--,this.textureIndex<0&&(this.textureIndex=0),t}}var H,J,$=a(4381),Q=a(4112),tt=a(9613),et=a(314),it=a(6878);class st{constructor(){this.importedTexture=$,this.availableTypes=["knife","pistol"],this.weapons=[],this.texturesCount=new b(8,4),this.timeSinceLastUpdate=0,this.texture=new Image,this.texture.src=$,this.weapons.push(new K("knife",2.4,40,[0,1,2,3,4],[],3,Q)),this.weapons[0].range=.75*P.gridSize,this.weapons.push(new K("pistol",2.4,70,[8,9,10,11,12],[],10,tt)),this.weapons.push(new K("machinegun",6,70,[16,17],[18,19],19,et)),this.weapons.push(new K("chaingun",12,70,[24,25],[26,27],26,it)),this.textureNumber=this.currentWeapon.initTextures[0]}get textureSize(){return this.texturesCount.map((t=>1/t))}get currentWeapon(){return this.weapons.find((t=>t.type==at.instance.weapon))}update(t){if(this.timeSinceLastUpdate+=t,0<ot.instance.lastNumber&&ot.instance.lastNumber<=this.weapons.length)for(let t=0;t<this.weapons.length;t++)ot.instance.lastNumber==t+1&&this.availableTypes.includes(this.weapons[t].type)&&(at.instance.weapon=this.weapons[t].type);this.setShooting(ot.instance.shooting&&at.instance.ammo>0),ot.instance.shot&&(at.instance.ammo>0||"knife"==this.currentWeapon.type)&&(this.shoot(),ot.instance.justShot=!0),this.currentWeapon.justShot&&(this.decreaseAmmo(),this.currentWeapon.audio.play());const e=1/(this.currentWeapon.fireRate*this.currentWeapon.framesCount);this.currentWeapon.justShot=!1,this.timeSinceLastUpdate>=e&&(this.timeSinceLastUpdate=0,this.textureNumber=this.currentWeapon.getNextTexture())}decreaseAmmo(){"knife"!=this.currentWeapon.type&&(at.instance.ammo>0&&at.instance.ammo--,0==at.instance.ammo&&(at.instance.weapon="knife"))}shoot(){this.currentWeapon.isAutomatic||(this.currentWeapon.willShoot=!0)}setShooting(t){this.currentWeapon.isAutomatic&&(this.currentWeapon.shooting=t)}draw(t){const e=Math.floor(this.textureNumber/this.texturesCount.x),i=this.textureNumber%this.texturesCount.x;t.drawImage(this.texture,64*i,64*e,64,64,163.9*P.uiScale,(312-307.2)*P.uiScale,64*P.uiScale*4.8,64*P.uiScale*4.8)}}class rt{constructor(){this.progress=0,this.state="beforeLoading",this.loadingTime=1,this.beforeLoadingDelay=.3,this.afterLoadingDelay=.3,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.canvas.width=320,this.canvas.height=200,this.uiElements=new Image,this.uiElements.src=E}update(t){if("loading"==at.instance.state&&(this.ctx.fillStyle="#004141",this.ctx.fillRect(0,0,320,160),this.ctx.drawImage(this.uiElements,0,160,224,48,48,56,224,48),"beforeLoading"==this.state?(this.progress+=t,this.progress>=this.beforeLoadingDelay&&(this.state="loading",this.progress=0)):"loading"==this.state?(this.progress+=t/this.loadingTime,this.progress>=1&&(this.progress=0,this.state="afterLoading")):"afterLoading"==this.state&&(this.progress+=t,this.progress>=this.afterLoadingDelay&&(this.progress=0,at.instance.state="game",at.instance.startTime=new Date)),"beforeLoading"!=this.state)){let t=214*this.progress;"afterLoading"==this.state&&(t=214),t>0&&(this.ctx.fillStyle="#ff0000",this.ctx.fillRect(53,101,t,2),this.ctx.fillStyle="#ff9e9e",this.ctx.fillRect(53,101,t-1,1))}}}class nt{constructor(){this.frame=0,this.started=!1,this.reversed=!1,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.canvas.width=320,this.canvas.height=200,this.pixels=this.ctx.createImageData(this.canvas.width,this.canvas.height)}start(){this.started||(this.started=!0,this.interval=setInterval((()=>this.update()),1))}setPixelRed(t,e){var i=4*t+4*e*this.canvas.width;this.pixels.data[i+3]=255,this.pixels.data[i+0]=255,this.pixels.data[i+1]=0,this.pixels.data[i+2]=0}setPixelTransparent(t,e){var i=4*t+4*e*this.canvas.width;this.pixels.data[i+3]=0,this.pixels.data[i+0]=0,this.pixels.data[i+1]=0,this.pixels.data[i+2]=0}feistelNet(t){for(var e=255&t,i=t>>8,s=0;s<8;s++){var r=i;i=e^255&(11*i+(i>>5)+889^i),e=r}return 65535&(i<<8|e)}update(){for(let s=0;s<200;s++){65536==this.frame&&setTimeout((()=>{this.reversed=!0,setTimeout((()=>{this.frame=0,this.started=!1,this.reversed=!1,clearInterval(this.interval),this.interval=null}),1e4)}),2e3);var t=this.feistelNet(this.frame),e=t%this.canvas.width,i=Math.floor(t/this.canvas.width);e<this.canvas.width&&i<this.canvas.height&&(this.reversed?this.setPixelTransparent(e,i):this.setPixelRed(e,i)),this.frame++}this.ctx.fillStyle="green",this.ctx.fillRect(0,0,100,100),this.ctx.putImageData(this.pixels,0,0)}}class at{constructor(){this.audioSplash=new L(V,P.musicVolume),this.audioMenu=new L(G,P.musicVolume),this.audioLevel=new L(Z,P.musicVolume),this.floor=1,this.score=0,this.lives=3,this.health=100,this.ammo=8,this.weapon="pistol",this.faceDirection="right",this.faceState="normal",this.faceAnimationSteps=[],this.lastFaceAnimationStepsCount=null,this.showingMenu=!0,this.state="startScreen",this.flashing=!1,this.flashCompletion=0,this.flashDuration=.2,this.enemiesKilled=0,this.secretsFound=0,this.treasuresFound=0,this.menu=new W,this.loadingScreen=new rt,this.levelEnd=new X,this.deathScreen=new nt,this.audioSplash.loop(),this.audioMenu.loop(),this.audioLevel.loop()}init(){this.texture=new Image,this.texture.src=B,this.elements=new Image,this.elements.src=E,this.startScreen=new Image,this.startScreen.src=M;const t=document.getElementById("uiCanvas");t.width=640*P.uiScale,t.height=400*P.uiScale,this.context=t.getContext("2d"),this.context.imageSmoothingEnabled=!1,document.onclick=t=>{"startScreen"==this.state&&this.audioSplash.playIfNotPlayed()},document.onkeydown=t=>{"startScreen"==this.state&&"Space"==t.code&&this.audioSplash.playIfNotPlayed()},document.onkeyup=t=>{"startScreen"==this.state&&"Space"==t.code&&this.audioSplash.playIfNotPlayed()},this.weapons=new st}takeLife(){0==this.lives?(this.floor=1,this.lives=3):this.lives--,this.health=100,this.ammo=8,this.weapon="pistol",this.score=0}update(t){this.weapons.update(t),this.loadingScreen.update(t);const e=this.faceAnimationSteps[0];e&&(e.duration-=t,e.duration<=0&&this.faceAnimationSteps.shift(),0==this.faceAnimationSteps.length&&this.startFaceAnimation(),this.faceDirection=this.faceAnimationSteps[0].direction),e||this.startFaceAnimation(),this.menu.update(t),this.levelEnd.update(t),this.flashing&&(this.flashCompletion+=t/this.flashDuration,this.flashCompletion>=1&&(this.flashCompletion=0,this.flashing=!1))}startFaceAnimation(){const t=3==this.lastFaceAnimationStepsCount?5:3;for(let e=0;e<t;e++){const t=.5,i=1.5,s=Math.random()*(i-t)+t;let r;r=e%2?"right":"left",this.faceAnimationSteps.push({direction:r,duration:s})}this.lastFaceAnimationStepsCount=this.faceAnimationSteps.length,this.faceAnimationSteps.push({direction:"normal",duration:2})}draw(t){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(t,16*P.uiScale,8*P.uiScale,608*P.uiScale,304*P.uiScale),this.context.drawImage(this.texture,0,0,640*P.uiScale,400*P.uiScale),this.drawNumber(this.floor,64,352),this.drawNumber(this.score,192,352),this.drawNumber(this.lives,240,352),this.drawNumber(this.health,384,352),this.drawNumber(this.ammo,464,352),this.drawWeaponUI(),this.weapons.draw(this.context),this.drawFace(),this.flashing&&(this.context.fillStyle=`rgba(${this.flashColor}, ${(1-this.flashCompletion)*this.flashIntensity})`,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height)),"startScreen"==this.state?this.context.drawImage(this.startScreen,0,0,640*P.uiScale,400*P.uiScale):"menu"==this.state?this.context.drawImage(this.menu.canvas,0,0,640*P.uiScale,400*P.uiScale):"loading"==this.state?this.context.drawImage(this.loadingScreen.canvas,0,0,640*P.uiScale,400*P.uiScale):"end"==this.state?this.context.drawImage(this.levelEnd.canvas,0,0,640*P.uiScale,400*P.uiScale):"dead"==this.state&&setTimeout((()=>this.deathScreen.start()),1500),this.context.drawImage(this.deathScreen.canvas,16*P.uiScale,8*P.uiScale,608*P.uiScale,304*P.uiScale)}drawFace(){let t=0,e=0;0==this.health?(e=7,t=1):"normal"==this.faceState?("left"==this.faceDirection?t=0:"normal"==this.faceDirection?t=1:"right"==this.faceDirection&&(t=2),e=Math.floor(this.health/(100/7)),7==e&&(e=6),e=6-e):"win"==this.faceState&&(e=7,t=0),this.context.drawImage(this.elements,240+24*t,31*e,24,31,274*P.uiScale,330*P.uiScale,48*P.uiScale,62*P.uiScale)}drawWeaponUI(){let t=0;"knife"==this.weapon?t=0:"pistol"==this.weapon?t=1:"machinegun"==this.weapon?t=2:"chaingun"==this.weapon&&(t=3),this.context.drawImage(this.elements,48*t,0,48,24,512*P.uiScale,336*P.uiScale,96*P.uiScale,48*P.uiScale)}drawNumber(t,e,i){const s=t.toString().split("").reverse().map((t=>parseInt(t)));for(let[t,r]of s.entries())this.drawDigit(r,e-16*(t+1),i)}drawDigit(t,e,i){this.context.drawImage(this.elements,8*t,32,8,16,e*P.uiScale,i*P.uiScale,16*P.uiScale,32*P.uiScale)}flashRed(){this.flashColor="255, 0, 0",this.flashIntensity=.3,this.flashing=!0}flashYellow(){this.flashColor="255, 255, 0",this.flashIntensity=.2,this.flashing=!0}}H=at,at.instance=new H;class ot{constructor(){this.direction=v.zero,this.rotation=0,this.sprinting=!1,this.shooting=!1,this.shot=!1,this.justShot=!0,this.interacting=!1,this.justInteracted=!1,this.noclip=!1,this.renderWalls=!0,this.justChangedRenderWalls=!1,this.lastNumber=null,this.pressedKeys=[],this.addKeyUpListener(),this.addKeyDownListener(),this.addAdditionalListeners()}get inputsBlocked(){return"game"!=at.instance.state}update(){this.direction=v.zero,this.rotation=0,this.shooting=!1,this.shot=!1,this.interacting=!1,this.noclip=!1,this.sprinting=!1,this.lastNumber=null,this.inputsBlocked||(!this.isPressed("ArrowUp")&&!this.isPressed("KeyW")||this.isPressed("KeyS")||this.isPressed("ArrowDown")||(this.direction.z=1),!this.isPressed("ArrowDown")&&!this.isPressed("KeyS")||this.isPressed("KeyW")||this.isPressed("ArrowUp")||(this.direction.z=-1),this.direction=this.direction.normalize,!this.isPressed("KeyA")&&!this.isPressed("ArrowLeft")||this.isPressed("ArrowRight")||this.isPressed("KeyD")||(this.rotation=-1),!this.isPressed("KeyD")&&!this.isPressed("ArrowRight")||this.isPressed("ArrowLeft")||this.isPressed("KeyA")||(this.rotation=1),this.isPressed("Space")&&(this.shooting=!0),this.isPressed("Space")?this.justShot||(this.shot=!0):this.justShot=!1,this.isPressed("KeyE")?this.justInteracted||(this.interacting=!0):this.justInteracted=!1,P.debug&&(this.isPressed("KeyC")&&(this.noclip=!0),this.isPressed("ShiftLeft")&&(this.sprinting=!0)),this.isPressed("Digit0")&&(this.lastNumber=0),this.isPressed("Digit1")&&(this.lastNumber=1),this.isPressed("Digit2")&&(this.lastNumber=2),this.isPressed("Digit3")&&(this.lastNumber=3),this.isPressed("Digit4")&&(this.lastNumber=4),this.isPressed("Digit5")&&(this.lastNumber=5),this.isPressed("Digit6")&&(this.lastNumber=6),this.isPressed("Digit7")&&(this.lastNumber=7),this.isPressed("Digit8")&&(this.lastNumber=8),this.isPressed("Digit9")&&(this.lastNumber=9))}isPressed(t){return this.pressedKeys.includes(t)}addKeyUpListener(){addEventListener("keyup",(t=>{this.pressedKeys.includes(t.code)&&(this.pressedKeys=this.pressedKeys.filter((e=>e!=t.code)))}))}addKeyDownListener(){addEventListener("keydown",(t=>{this.pressedKeys.includes(t.code)||this.pressedKeys.push(t.code)}))}addAdditionalListeners(){addEventListener("keydown",(t=>{"Minus"==t.code?P.uiScale-=.1:"Equal"==t.code?P.uiScale+=.1:"Backspace"==t.code?P.uiScale=1:"KeyV"==t.code&&P.debug?this.renderWalls=!this.renderWalls:"Space"==t.code||"Enter"==t.code?"startScreen"==at.instance.state?(at.instance.state="menu",at.instance.audioSplash.pause(),at.instance.audioMenu.play()):"menu"==at.instance.state&&(0==at.instance.menu.option?(at.instance.menu.audioSelect.play(),at.instance.audioLevel.play(),at.instance.audioMenu.pause(),at.instance.state="loading"):8==at.instance.menu.option&&(at.instance.menu.audioSelect.play(),at.instance.audioMenu.pause(),at.instance.audioSplash.play(),at.instance.state="startScreen")):"Escape"==t.code&&"menu"==at.instance.state&&(at.instance.menu.audioBack.play(),at.instance.audioMenu.pause(),at.instance.audioSplash.play(),at.instance.state="startScreen")}))}}J=ot,ot.instance=new J;var ht=a(6213),lt=a(7704);class ct{constructor(t,e){this.transform=new A,this.killer=null,this.audioHit=new L(ht),this.audioDeath=new L(lt),this.fov=60,this.zNear=P.gridSize/64,this.zFar=48*P.gridSize,this.rotationSpeed=1.6,this.movementSpeed=5*P.gridSize,this.collisionRadius=P.gridSize/3,this.interactionDistance=1.5*P.gridSize,this.blockedDirections=[],this.gl=t,this.updateProjectionMatrix(),this.transform.rotation.y=w(90)}get matrix(){let t=S.identity;return t=S.translate(t,this.transform.position.inverted),t=S.yRotate(t,this.transform.rotation.y),t}update(t){this.rotate(ot.instance.rotation*t);let e=ot.instance.direction.multiply(t);ot.instance.sprinting&&(e=e.multiply(5)),ot.instance.noclip?this.move(e):this.move(e,this.collidingShapes)}nearest(t){return t.sort(((t,e)=>t.initialTransform.position.distanceTo(this.transform.position)-e.initialTransform.position.distanceTo(this.transform.position)))[0]}inInteractionDistance(t){return t.initialTransform.position.distanceTo(this.transform.position)<=this.interactionDistance}rotate(t){this.transform.rotation.y+=t*this.rotationSpeed}move(t,e){const i=S.yRotation(-this.transform.rotation.y);let s=t.inverted.multiply(this.movementSpeed).transformMat4(i);for(let t of this.blockedDirections)t.x&&t.z&&(Math.abs(t.x)>Math.abs(t.z)?t.x=0:t.z=0),t.z*s.z<0&&(s.z=0),t.x*s.x<0&&(s.x=0);e?this.checkCollisions(e.filter((t=>t.transform.position.distanceTo(this.transform.position)<2*P.gridSize))):this.blockedDirections=[],this.transform.position=this.transform.position.add(s)}angleTo(t){let e=t.substract(this.transform.position).yZeroed.normalize,i=v.fromAngle(this.transform.rotation.y),s=Math.atan2(e.z,e.x),r=y(Math.atan2(i.z,i.x)-s);return r>180&&(r-=360),r<-180&&(r+=360),r}cuboidCollisionSide(t){const e=this.transform.position.yZeroed.to(t.transform.position.yZeroed).normalize;let i=1;t instanceof D&&(i=10);let s=[this.transform.position];for(let t=this.collisionRadius;t>0;t-=this.collisionRadius/i){const i=t,r=e.multiply(i),n=this.transform.position.add(r);s.push(n)}for(let e of s)if(t.bb.isColliding(e)){let i=t.bb.nearestDistanceDirection(this.transform.position);if(i.x&&i.z){const s=t.bb.nearestCorner(e),r=this.transform.position.substract(s).abs;r.x>r.z?i.z=0:i.x=0}return i}return null}checkCollisions(t){const e=t.map((t=>this.cuboidCollisionSide(t))).filter((t=>null!==t)).filter(((t,e,i)=>e===i.findIndex((e=>e.equals(t)))));this.blockedDirections=e}isLookingAt(t){const e=v.fromAngle(this.transform.rotation.y),i=v.up.cross(e).normalize,s=t.transform.position.add(i.multiply(t.texturedSize.x/2)),r=t.transform.position.substract(i.multiply(t.texturedSize.x/2)),n=this.angleTo(s),a=this.angleTo(r);return 0<n&&n<90&&-90<a&&a<0}get viewProjectionMatrix(){return S.multiply(this.matrix,this.projectionMatrix)}updateProjectionMatrix(){const t=w(this.fov),e=this.zNear,i=this.zFar;this.projectionMatrix=S.perspective(t,2,e,i)}lookAt(t){let e=t.substract(this.transform.position).yZeroed.normalize,i=Math.atan2(e.z,e.x);this.transform.rotation.y=i+w(90)}lookAtKillerStep(t){const e=this.angleTo(this.killer.transform.position);Math.abs(e)<Math.abs(y(this.rotationSpeed*t))?this.lookAt(this.killer.transform.position):e>0?this.rotate(-1*t):e<0&&this.rotate(1*t)}}class ut{constructor(t){this.gl=t}load(t,e){let i=new Map;const s=[...new Set(t.map((t=>t.importedTexture)))];this.loadHtmlImages(s,(s=>{for(let e of t){if(!i.has(e.importedTexture)){const t=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s.get(e.importedTexture)),this.gl.generateMipmap(this.gl.TEXTURE_2D),i.set(e.importedTexture,t)}e.webglTexture=i.get(e.importedTexture)}null==e||e()}))}loadHtmlImages(t,e){let i=[],s=t.length;const r=()=>{if(0==--s){const s=new Map;for(let e=0;e<t.length;e++)s.set(t[e],i[e]);e(s)}};for(let e=0;e<s;e++){const s=new Image;s.src=t[e],i.push(s),s.onload=r}}}class dt extends C{constructor(t,e,i){super(t,e),this.importedTexture=I,this.texturesInLine=16,this.nearDoorLightTexture=106,this.nearDoorDarkTexture=107,this.value=i}onCreation(){this.transform.scale=v.one.multiply(P.gridSize),this.setTexture(this.lightTexture),this.setTexture(this.darkTexture,2),this.setTexture(this.darkTexture,3)}get textureColor(){for(let t of["gray","blue","brown"])if(this.value.toLowerCase().includes(t))return t;return"gray"}get textureName(){for(let t of["F","E","H","B","S","E","H"])if(this.value.substr(-1)==t)return t;return null}get lightTexture(){return this.transform.rotation.y?this._darkTexture:this._lightTexture}get darkTexture(){return this.transform.rotation.y?this._lightTexture:this._darkTexture}get _lightTexture(){switch(this.value){case"exitRailWall":return 100;case"secretExitRailWall":return 122}switch(this.textureColor){case"gray":switch(this.textureName){case"F":return 4;case"H":return 16;case"E":return 20;default:return 0}case"blue":switch(this.textureName){case"B":return 18;case"S":return 32;default:return 34}case"brown":switch(this.textureName){case"E":return 48;case"H":return 50;default:return 52}}}get _darkTexture(){switch(this.value){case"exitRailWall":case"secretExitRailWall":return this._lightTexture;default:return this._lightTexture+1}}}var pt=a(3108);const mt=["lamp","goldenLamp","puddle","bucket","skeleton","bones","bones1","bones2","bones3","bloodBones","enemy","enemyXWalking","enemyYWalking","enemyUp","enemyDown","enemyLeft","enemyRight","dogFood","food","health","ammo","powerUp","machinegun","chaingun"];var ft;class gt{constructor(){this.allSubFieldsCreated=[],this.envFields=[],this.open=[],this.closed=[],this.subdivisions=3}get subGridSize(){return P.gridSize/this.subdivisions}prepareLevel(t){this.envFields=t.gridFields,this.allSubFieldsCreated=[]}subFieldPosData(t){const e=this.subGridPosToGridPos(t),i=this.envFields.find((t=>new b(t.x,t.y).equals(e)));return{walkable:!i||mt.includes(i.value)||i.value.toLowerCase().includes("door"),shape:null==i?void 0:i.value}}subGridPosToGridPos(t){return t.map((t=>Math.floor(t/this.subdivisions)))}gridPosToRealPos(t){const e=t.map((t=>t*P.gridSize+P.gridSize/2));return new v(e.x,0,e.y)}realPosToSubGridPos(t){const e=t.map((t=>Math.floor(t/this.subGridSize)));return new b(e.x,e.z)}getAllPathLocations(t,e){const i=this.realPosToSubGridPos(t),s=this.realPosToSubGridPos(e);return this._getAllPathfindLocations(i,s).map((t=>({subGridPos:this.subGridPosToRealPos(t.position),shape:t.shape,realPos:this.gridPosToRealPos(this.subGridPosToGridPos(t.position))})))}subGridPosToRealPos(t){const e=t.map((t=>t*this.subGridSize+this.subGridSize/2));return new v(e.x,0,e.y)}_getAllPathfindLocations(t,e){this.open=[],this.closed=[];const i=new xt(t,!0);this.open.push(i);const{walkable:s,shape:r}=this.subFieldPosData(e),n=new xt(e,s,r);if(!n.walkable)return[];for(;;){if(0==this.open.length)return[];const t=this.leastFCostField();if(t.position.equals(n.position))return i.position.equals(n.position)?[]:this.getPathUsingParents(t);{const e=this.getValidNeighbours(t);for(let i of e)this.calculateCost(i,t,n)}}}leastFCostField(){const t=this.open.reduce(((t,e)=>t.fCost<e.fCost?t:e));return this.open=this.open.filter((e=>e!=t)),this.closed.push(t),t}calculateCost(t,e,i){if(!this.open.includes(t)||t.gCostWithParent(e)<t.gCost){t.parent=e;const s=i.position.substract(t.position).abs;t.hCost=10*(s.x+s.y),this.open.every((e=>!e.position.equals(t.position)))&&this.open.push(t)}}getValidNeighbours(t){return[new b(-1,-1),new b(-1,0),new b(-1,1),new b(0,-1),new b(0,1),new b(1,-1),new b(1,0),new b(1,1)].map((e=>{const i=t.position.add(e),s=this.allSubFieldsCreated.find((t=>t.position.equals(i)));if(s)return s;{let{walkable:s,shape:r}=this.subFieldPosData(i);if(e.x&&e.y&&s){const e=[new b(i.x,t.position.y),new b(t.position.x,i.y)].every((t=>{const{walkable:e,shape:i}=this.subFieldPosData(t);return e}));e||(s=!1)}const n=new xt(i,s,r);return this.allSubFieldsCreated.push(n),n}})).filter((t=>t.walkable&&!this.closed.includes(t)))}getPathUsingParents(t){let e=[];for(e.push(t);t.parent;)t=t.parent,e.push(t);return e.reverse(),e.shift(),e}}ft=gt,gt.instance=new ft;class xt{constructor(t,e,i){this.position=t,this.walkable=e,this.shape=i}get gCost(){return this.parent?this.gCostWithParent(this.parent):0}gCostWithParent(t){const e=t.position.substract(this.position);return e.x&&e.y?t.gCost+14:t.gCost+10}get fCost(){return this.gCost+this.hCost}}class yt{constructor(t,e){this.from=t.clone(),this.dir=e.clone(),this.squareGenerator=this.nextSquareGenerator()}static fromDir(t,e){return new yt(t,e)}static fromTo(t,e){const i=e.substract(t).yZeroed.normalize;return new yt(t,i)}nextSquare(){return this.squareGenerator.next().value}nextShape(t){let e=this.nextSquare();for(let i=0;i<200;i++)if(e){for(let i of t)if(i.transform.position.yZeroed.equals(e.yZeroed))return i;e=this.nextSquare()}return null}*nextSquareGenerator(){let t=this.from.clone(),e=this.dir.clone();const i=P.gridSize,s=t.map((t=>Math.floor(t/i)*i+i/2)).yZeroed;yield s;let r=!0;for(;;){const[i,s]=this.nextSquareInner(t,e);r&&(r=!1),yield i,t=s}}nextSquareInner(t,e){const i=P.gridSize;e.x>=0?t.x+=1e-4*i:t.x-=1e-4*i,e.z>=0?t.z+=1e-4*i:t.z-=1e-4*i;const s=t.map((t=>Math.floor(t/i)*i+i/2)).yZeroed;let r=v.zero;t.x*e.x>0?r.x=Math.ceil(t.x/i)*i:r.x=Math.floor(t.x/i)*i,t.z*e.z>0?r.z=Math.ceil(t.z/i)*i:r.z=Math.floor(t.z/i)*i;const n=t.substract(r).abs,a=Math.abs(n.z/n.x),o=Math.abs(e.z/e.x);let h,l;a>o?(h=new v(1,0,0),l=new v(r.x,0,t.z+e.z/e.x*(r.x-t.x))):(h=new v(a<o?0:1,0,1),l=new v(t.x+e.x/e.z*(r.z-t.z),0,r.z));const c=new v(e.x>0?h.x:-h.x,0,e.z>0?h.z:-h.z);return[s.add(c.multiply(i)),l]}}var wt=a(4227),St=a(2268);class bt extends T{constructor(t,e){super(t,e),this.VERTICES=new Float32Array([.5,0,.5,-.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,-.5,.5,0,.5]),this.TEXCOORDS=new Float32Array([1,1,0,0,0,1,1,0,0,0,1,1]),this.COLORS=new Uint8Array([80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200]),this.importedTexture=St,this.transform.scale.set(P.gridSize,1,P.gridSize)}setColor(t){let e=v.arrayToVec3Array(this.COLORS);e=e.map((e=>{return(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))?new v(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)):null;var i})),this.COLORS=new Uint8Array(v.vec3ArrayToArray(e))}}class vt extends bt{constructor(){super(...arguments),this.importedTexture=wt,this.pickupRange=.5*P.gridSize,this.pickedUp=!1,this.firstTextureSet=!1,this.texturesInLine=8}onCreation(){this.transform.scale=v.one.multiply(P.gridSize),this.transform.rotation.x=w(90),this.setTexture(this.textureNumber)}lookAtCamera(t){this.transform.rotation.y=-t}get textureSize(){return 1/this.texturesInLine}canBePickedUp(t){return!0}pickUp(t){!this.pickedUp&&this.canBePickedUp(t)&&(this.onPickedUp(t),this.audio.play(),at.instance.flashYellow(),this.pickedUp=!0)}onPickedUp(t){}setTexture(t){if(t==this.textureNumber&&this.firstTextureSet)return;this.textureNumber=t;let e=b.arrayToVec2Array(this.initialTexcoords);const i=new b(t%this.texturesInLine,Math.floor(t/this.texturesInLine)).multiply(this.textureSize);e=e.map((t=>t.multiply(this.textureSize).add(i))),this.TEXCOORDS=new Float32Array(b.vec2ArrayToArray(e)),this.firstTextureSet||(this.firstTextureSet=!0,this.updateBuffers())}}var At=a(8964);class Tt extends vt{constructor(){super(...arguments),this.textureNumber=43,this.ammoCount=4,this.audio=new L(At)}onPickedUp(t){at.instance.ammo+=this.ammoCount,"knife"==at.instance.weapon&&(at.instance.weapon=at.instance.weapons.availableTypes[at.instance.weapons.availableTypes.length-1])}}class zt extends vt{constructor(){super(...arguments),this.textureNumber=6,this.audio=new L(At)}onCreation(){super.onCreation(),this.transform.scale=this.transform.scale.multiply(.5),this.transform.position.y=-50}onPickedUp(t){}}var Ct=a(9435),It=a(7120),Pt=a(1669),Rt=a(6121),kt=a(4830),Lt=a(933),Dt=a(2764),Bt=a(6178),Et=a(9040),Mt=a(6919);class _t extends bt{constructor(t,e,i){super(t,e),this.pathfinderFields=[],this.score=100,this.importedTexture=pt,this.texturedWidth=28/64,this.textureRotation=0,this.texturesInLine=8,this.stateToTextureMap=new Map([["shooting",[48,49,50]],["standing",[0]],["walking",[8,16,24,32]],["dying",[40,41,42,43,44]],["hit",[47,0]],["dead",[44]]]),this.shotNoticeDistance=10*P.gridSize,this.dir=v.zero,this.shootingDistance=5*P.gridSize,this.damageDealed=8,this.walkingDirection=v.zero,this.state="standing",this.timeSinceLastUpdate=0,this.hp=100,this.followingSpeed=1.25*P.gridSize,this.nextDir=null,this.timeSinceLastPathfinding=0,this.pathfindingDelay=.5,this.frameTime=.2,this.audioSight=new L(Mt),this.audiosDie=[new L(It),new L(Pt),new L(Rt),new L(kt),new L(Lt),new L(Dt),new L(Bt),new L(Et)],this.audioShot=new L(Ct),this.loot=new Tt(this.gl,e),this.tempFlag=new zt(this.gl,e),this.tempFlag.setInitialState(),this.transform.rotation.x=w(90),"x"==i?(this.walkingDirection=v.right,this.state="walking",this.dir=this.walkingDirection):"z"==i?(this.walkingDirection=v.forward,this.state="walking",this.dir=this.walkingDirection):"up"==i?this.dir=v.forward:"down"==i?this.dir=v.backward:"left"==i?this.dir=v.left:"right"==i&&(this.dir=v.right),this.initialState=this.state}get isDead(){return this.hp<=0}update(t,e){if("end"==at.instance.state)this.followingPlayer=null;else{this.timeSinceLastUpdate+=t;const i="shooting"==this.state?.3:this.frameTime;if(this.timeSinceLastUpdate>i){this.timeSinceLastUpdate=0;const t=this.stateToTextureMap.get(this.state),i=t.indexOf(this.textureNumber)+1;i<t.length?this.setTexture(t[i]):(this.textureNumber=0,"dying"==this.state?(this.state="dead",at.instance.enemiesKilled++):"hit"==this.state?this.state="walking":this.setTexture(t[0])),"shooting"==this.state&&i==t.length-1&&at.instance.health>0&&(at.instance.health-=Math.floor(Math.random()*(2*this.damageDealed-.75*this.damageDealed))+.75*this.damageDealed,at.instance.flashRed(),this.audioShot.play(),e.audioHit.play(),at.instance.health<=0&&(at.instance.health=0,e.killer=this)),this.followingPlayer&&0==at.instance.health&&(this.followingPlayer=null,this.dir=this.transform.position.to(e.transform.position),this.state="standing")}this.updateBuffers()}}damage(t){["dying","dead"].includes(this.state)||(this.hp-=t,this.state="hit",this.timeSinceLastUpdate=0,this.hp<=0&&(this.hp=0,this.state="dying",this.audiosDie[Math.floor(Math.random()*this.audiosDie.length)].play()))}lookAtCamera(t){this.transform.rotation.y=-t}pathfind(t){}makeStepTowardsPlayer(t,e){if(this.timeSinceLastPathfinding+=t,this.followingPlayer){if(this.timeSinceLastPathfinding>=this.pathfindingDelay&&(this.timeSinceLastPathfinding=0,this.pathfinderFields.length<=80?(this.pathfinderFields=gt.instance.getAllPathLocations(this.transform.position,this.followingPlayer.transform.position),this.pathfinderFields=this.pathfinderFields.map((t=>({subGridPos:new v(t.subGridPos.x,-30,t.subGridPos.z),shape:t.shape,realPos:t.realPos})))):(this.state="standing",this.followingPlayer=null,this.pathfinderFields=[])),this.pathfinderFields.length<=1)return;this.dir=this.pathfinderFields[1].subGridPos.substract(this.transform.position).yZeroed.normalize;for(let t=1;t<3;t++){const i=this.pathfinderFields[t];if(i&&"door"==i.shape){const t=e.find((t=>t.initialTransform.position.yZeroed.equals(i.realPos.yZeroed)));t&&t.canInteract&&t.toggle();break}}this.transform.position=this.transform.position.add(this.dir.multiply(this.followingSpeed*t))}}makeStepIfWalking(t,e){if(!this.followingPlayer&&"walking"==this.initialState&&"walking"==this.state){const i=yt.fromDir(this.transform.position,this.dir).nextShape(e);i&&(this.transform.position.distanceTo(i.transform.position)<=P.gridSize&&!this.nextDir&&(this.nextDir=this.dir.inverted,this.state="standing",setTimeout((()=>{this.dir=this.nextDir,setTimeout((()=>{this.state="walking",this.nextDir=null}),500)}),1e3)),this.transform.position=this.transform.position.add(this.dir.multiply(this.followingSpeed*t)))}}rotateTexture(t){let e=t.substract(this.transform.position).yZeroed.normalize,i=Math.atan2(e.z,e.x),s=y(Math.atan2(this.dir.z,this.dir.x)-i);s>180&&(s-=360),s<-180&&(s+=360);const r=s>0?s+22.5:s-22.5;return this.textureRotation=parseInt((r/45).toString()),s}canSee(t,e){const i=yt.fromTo(this.transform.position,t.yZeroed).nextShape(e);return!!i&&i.transform.position.yZeroed.distanceTo(this.transform.position.yZeroed)>this.transform.position.yZeroed.distanceTo(t.yZeroed)}tryToShoot(t,e){return!("dead"==this.state||"dying"==this.state||"hit"==this.state||!this.followingPlayer||(at.instance.health>0?this.transform.position.distanceTo(t.transform.position)<=this.shootingDistance&&this.canSee(t.transform.position,e)?(this.state="shooting",0):(this.state="walking",1):(this.state="standing",this.followingPlayer=null,1)))}get textureSize(){return 1/this.texturesInLine}setTexture(t){this.textureNumber=t,"walking"!=this.state&&"standing"!=this.state||(this.textureRotation>=0?t+=this.textureRotation:t+=this.textureRotation+this.texturesInLine);let e=b.arrayToVec2Array(this.initialTexcoords);const i=new b(t%this.texturesInLine,Math.floor(t/this.texturesInLine)).multiply(this.textureSize);e=e.map((t=>t.multiply(this.textureSize).add(i))),this.TEXCOORDS=new Float32Array(b.vec2ArrayToArray(e))}}class Ft extends vt{onPickedUp(t){at.instance.health+=this.healthRestored,at.instance.health>100&&(at.instance.health=100)}canBePickedUp(t){return at.instance.health<100}}var Nt=a(9420);class Ot extends Ft{constructor(){super(...arguments),this.healthRestored=4,this.textureNumber=11,this.audio=new L(Nt)}}class Ut extends Ft{constructor(){super(...arguments),this.healthRestored=10,this.textureNumber=41,this.audio=new L(Nt)}}var jt=a(1491);class Wt extends Ft{constructor(){super(...arguments),this.healthRestored=25,this.textureNumber=42,this.audio=new L(jt)}}var Vt=a(4452);class Gt extends vt{constructor(){super(...arguments),this.textureNumber=44,this.audio=new L(Vt)}onPickedUp(t){at.instance.weapons.availableTypes.push("machinegun"),at.instance.weapon="machinegun"}}const Zt=new Map([["demo",0],["deathcam",1],["puddle",2],["greenBarrel",3],["table",4],["blood",5],["flag",6],["standingLamp",8],["goldenLamp",9],["hangingSkeleton",10],["pillar",12],["bones1",13],["pots",14],["furnance",15],["greenPlant",16],["skeleton",17],["sink",18],["brownPlant",19],["urn",20],["bones2",21],["bones3",22],["table",24],["lamp",25],["morePots",26],["armor",27],["cage",28],["spears",29],["vines",30],["skeletonCage",32],["bones",33],["bed",36],["bucket",40],["bloodBones",57],["brownBarrel",58],["well",59],["emptyWell",60]]);class qt{constructor(t,e){this.center=t,this.size=e}get halfSize(){return this.size.multiply(.5)}get negativeCorner(){return this.center.substract(this.halfSize)}get positiveCorner(){return this.center.add(this.halfSize)}isColliding(t){const e=this.positiveCorner,i=this.negativeCorner;return i.x<=t.x&&t.x<=e.x&&i.z<=t.z&&t.z<=e.z}pointSide(t){const e=this.center.substract(t);let i=v.zero;return e.x>this.halfSize.x&&(i.x=-1),e.x<-this.halfSize.x&&(i.x=1),e.z>this.halfSize.z&&(i.z=-1),e.z<-this.halfSize.z&&(i.z=1),i}nearestDistanceDirection(t){const e=this.pointSide(t);return e.x&&e.z?t.substract(this.nearestCorner(t)).yZeroed.normalize:e}pointFarthestSide(t){const e=this.center.substract(t);let i=this.pointSide(t);return i.x&&i.z&&(Math.abs(e.x)>Math.abs(e.z)?i.z=0:i.x=0),i}nearestCorner(t){const e=this.center.substract(t);if(e.x<=0&&e.z<=0)return this.center.substract(this.halfSize);if(e.x<=0&&e.z>=0){const t=new v(-this.halfSize.x,0,this.halfSize.z);return this.center.substract(t)}if(e.x>=0&&e.z<=0){const t=new v(this.halfSize.x,0,-this.halfSize.z);return this.center.substract(t)}return e.x>=0&&e.z>=0?this.center.add(this.halfSize):void 0}basePointsYZeroed(){const t=this.halfSize.yZeroed;return[this.center.add(t),this.center.add(t.xInverted),this.center.add(t.yInverted),this.center.substract(t)]}}class Yt extends bt{constructor(t,e,i){super(t,e),this.importedTexture=wt,this.firstTextureSet=!1,this.texturesInLine=8,this.type=i}createBB(){this.bb=new qt(this.transform.position,v.one.multiply(P.gridSize))}get textureNumber(){return Zt.get(this.type)}onCreation(){this.transform.scale=v.one.multiply(P.gridSize),this.transform.rotation.x=w(90),this.setTexture(this.textureNumber)}lookAtCamera(t){this.transform.rotation.y=-t}get textureSize(){return 1/this.texturesInLine}setTexture(t){let e=b.arrayToVec2Array(this.initialTexcoords);const i=new b(t%this.texturesInLine,Math.floor(t/this.texturesInLine)).multiply(this.textureSize);e=e.map((t=>t.multiply(this.textureSize).add(i))),this.TEXCOORDS=new Float32Array(b.vec2ArrayToArray(e)),this.firstTextureSet||(this.firstTextureSet=!0,this.updateBuffers())}}class Xt extends vt{onPickedUp(t){at.instance.score+=this.givenScore,at.instance.treasuresFound++}}var Kt=a(1559);class Ht extends Xt{constructor(){super(...arguments),this.textureNumber=49,this.givenScore=100,this.audio=new L(Kt)}}var Jt=a(8077);class $t extends Xt{constructor(){super(...arguments),this.textureNumber=50,this.givenScore=500,this.audio=new L(Jt)}}var Qt=a(2551);class te extends Xt{constructor(){super(...arguments),this.textureNumber=51,this.givenScore=1e3,this.audio=new L(Qt)}}var ee=a(6217);class ie extends Xt{constructor(){super(...arguments),this.textureNumber=52,this.givenScore=5e3,this.audio=new L(ee)}}var se=a(3185);class re extends vt{constructor(){super(...arguments),this.textureNumber=56,this.audio=new L(se)}onPickedUp(t){at.instance.health=100,at.instance.ammo+=25,at.instance.lives++}}var ne=a(5589);class ae extends C{constructor(t,e,i){super(t,e),this.importedTexture=I,this.texturesInLine=16,this.audio=new L(ne),this.canInteract=!0,this.lightTexture=101,this.pressedTexture=113,this.value=i}onCreation(){this.transform.scale=v.one.multiply(P.gridSize),this.setTexture(this.lightTexture)}updateBuffers(){super.updateBuffers()}get darkTexture(){return this.lightTexture}toggle(){"end"!=at.instance.state&&(this.audio.play(),this.setTexture(this.pressedTexture),at.instance.state="end",at.instance.levelEnd.calculateValues(),at.instance.endTime=new Date,this.updateBuffers())}}var oe=a(1023);class he extends dt{constructor(){super(...arguments),this.canInteract=!0,this.dirToCalculate=!1,this.opening=!1,this.openingSpeed=.7*P.gridSize,this.audio=new L(oe)}toggle(){this.opening||(this.opening=!0,at.instance.secretsFound++,this.audio.play())}update(t,e){this.opening&&(this.dirToCalculate&&this.calculateDir(e),this.transform.position=this.transform.position.add(this.dir.multiply(t*this.openingSpeed)),this.initialTransform.position.distanceTo(this.transform.position)>=2*P.gridSize&&(this.opening=!1,this.canInteract=!1))}calculateDir(t){this.dir=v.fromAngle(this.transform.rotation.y);const e=t.transform.position.substract(this.transform.position);(this.dir.x>0&&e.x>0||this.dir.x<0&&e.x<0)&&(this.dir.x=-this.dir.x),(this.dir.z>0&&e.z>0||this.dir.z<0&&e.z<0)&&(this.dir.z=-this.dir.z),this.dirToCalculate=!1}}class le{constructor(t,e,i){this.enemies=[],this.walls=[],this.secretWalls=[],this.doors=[],this.shapes=[],this.collidingCuboids=[],this.interactables=[],this.pickups=[],this.decorations=[],this.gl=t,this.textureProgram=e,this.colorProgram=i}load(t,e){this.loadLevel(t,(()=>{this.createObjects(),gt.instance.prepareLevel(this),null==e||e()}))}spawnLoot(t){t.loot&&(this.pickups.push(t.loot),t.loot.transform.position=t.transform.position.clone(),t.loot.setInitialState())}get verticesCount(){return this.shapes.map((t=>t.verticesCount)).reduce(((t,e)=>t+e))}loadLevel(t,e){a(442)(`./${t}.json`).then((({default:t})=>{this.width=t.width,this.height=t.height,this.center=new v(this.width*P.gridSize/2,0,this.height*P.gridSize/2),this.fields=JSON.parse(JSON.stringify(t.fields)),this.checkWallsDirections(),this.changeWallsNeighboursTextures(),this.applyGridSize(),this.gridFields=JSON.parse(JSON.stringify(t.fields)),null==e||e()}))}checkWallsDirections(){for(let t of this.fields.filter((t=>"door"==t.value||"exitDoor"==t.value||t.value.toLowerCase().includes("secret")&&t.value.toLowerCase().includes("wall")))){const e=this.fields.filter((e=>e.y==t.y&&(e.x==t.x+1||e.x==t.x-1))).filter((t=>t.value.toLowerCase().includes("wall"))),i=this.fields.filter((e=>e.x==t.x&&(e.y==t.y+1||e.y==t.y-1))).filter((t=>t.value.toLowerCase().includes("wall")));2==e.length&&0==i.length?t.rotation=0:0==e.length&&2==i.length&&(t.rotation=270)}}changeWallsNeighboursTextures(){for(let t of this.fields.filter((t=>"door"==t.value||"exitDoor"==t.value)))for(let e of[[0,-1],[0,1],[-1,0],[1,0]]){const i=this.fields.find((i=>i.x==t.x+e[0]&&i.y==t.y+e[1]));i&&(i.wallDirection=e)}}applyGridSize(){for(let t of this.fields)t.x=t.x*P.gridSize+P.gridSize/2,t.y=t.y*P.gridSize+P.gridSize/2}createObjects(){const t=this.fields.find((t=>"player"==t.value));this.playerPosition=new v(t.x,0,t.y),this.walls=this.getLevelObjectsList("wall",dt),this.enemies=this.getLevelObjectsList("enemy",_t),this.doors=this.getLevelObjectsList("door",D);const e=this.getLevelObjectsList("ammo",Tt),i=this.getLevelObjectsList("dogFood",Ot),s=this.getLevelObjectsList("food",Ut),r=this.getLevelObjectsList("health",Wt),n=this.getLevelObjectsList("powerUp",re),a=this.getLevelObjectsList("machinegun",Gt),o=this.getLevelObjectsList("goldCross",Ht),h=this.getLevelObjectsList("goldCup",$t),l=this.getLevelObjectsList("goldBox",te),c=this.getLevelObjectsList("goldCrown",ie);this.exits=[],this.exits.push(...this.getLevelObjectsList("exitLever",ae)),this.exits.push(...this.getLevelObjectsList("secretExitLever",ae)),this.decorations=[];for(let t of Zt.keys())this.decorations.push(...this.getLevelObjectsList(t,Yt));this.decorations.filter((t=>!mt.includes(t.type))).forEach((t=>t.createBB())),this.secretWalls=this.walls.filter((t=>t instanceof he)).map((t=>t)),this.walls=this.walls.filter((t=>!(t instanceof he))),this.collidingCuboids=[],this.collidingCuboids.push(...this.walls),this.collidingCuboids.push(...this.secretWalls),this.collidingCuboids.push(...this.doors),this.collidingCuboids.push(...this.exits),this.interactables=[],this.interactables.push(...this.doors),this.interactables.push(...this.secretWalls),this.interactables.push(...this.exits),this.pickups=[],this.pickups.push(...e),this.pickups.push(...i),this.pickups.push(...s),this.pickups.push(...r),this.pickups.push(...n),this.pickups.push(...a),this.pickups.push(...o),this.pickups.push(...h),this.pickups.push(...l),this.pickups.push(...c),this.floor=new bt(this.gl,this.colorProgram),this.floor.setColor("#707070"),this.floor.transform.position=this.center.clone(),this.floor.transform.position.y=-P.gridSize/2,this.floor.transform.scale.set(this.width*P.gridSize,1,this.height*P.gridSize),this.ceiling=new bt(this.gl,this.colorProgram),this.ceiling.setColor("#383838"),this.ceiling.transform.position=this.center.clone(),this.ceiling.transform.position.y=P.gridSize/2,this.ceiling.transform.scale.set(this.width*P.gridSize,1,this.height*P.gridSize),this.ceiling.transform.rotation.z=w(180),at.instance.enemiesCount=this.enemies.length,at.instance.secretsCount=this.secretWalls.length,at.instance.treasuresCount=this.pickups.filter((t=>t instanceof Xt)).length,this.shapes=[...this.walls,...this.secretWalls,...this.enemies,...this.doors,...this.pickups,...this.decorations,...this.exits,this.floor,this.ceiling]}getLevelObjectsList(t,e){const i=[];for(let s of this.fields.filter((e=>e.value.toLowerCase().includes(t.toLowerCase())))){let r;if(s.value.toLowerCase().includes("wall"))r=s.value.toLowerCase().includes("wallsecret")?new he(this.gl,this.textureProgram,s.value):new dt(this.gl,this.textureProgram,s.value);else if(s.value.toLowerCase().includes("walking"))"enemyZWalking"==s.value?r=new _t(this.gl,this.textureProgram,"z"):"enemyXWalking"==s.value&&(r=new _t(this.gl,this.textureProgram,"x"));else if(s.value.toLowerCase().includes("door"))r="exitDoor"==s.value?new D(this.gl,this.textureProgram,s.value):new D(this.gl,this.textureProgram);else if(s.value.toLowerCase().includes("enemy"))for(let t of["up","down","left","right"])s.value.toLowerCase().includes(t)&&(r=new _t(this.gl,this.textureProgram,t));else r=new e(this.gl,this.textureProgram);if(r.transform.position.x=s.x,r.transform.position.z=s.y,s.rotation&&(r.transform.rotation.y=w(s.rotation)),s.value.toLowerCase().includes("wall")&&s.value.toLowerCase().includes("wallsecret")&&(r.dirToCalculate=!0),r.setInitialState(),s.wallDirection&&r instanceof dt){const t=new v(s.wallDirection[0],0,s.wallDirection[1]);t.equals(v.backward)&&r.setTexture(r.nearDoorDarkTexture,0),t.equals(v.forward)&&r.setTexture(r.nearDoorDarkTexture,1),t.equals(v.left)&&r.setTexture(r.nearDoorLightTexture,3),t.equals(v.right)&&r.setTexture(r.nearDoorLightTexture,2)}else r instanceof Yt&&(r.type=t,r.setTexture(r.textureNumber));i.push(r)}return i}}class ce extends T{constructor(t,e){super(t,e),this.VERTICES=new Float32Array([1,1,0,-1,1,0,-1,-1,0,-1,-1,0,1,-1,0,1,1,0]),this.COLORS=new Uint8Array([200,70,.52,200,70,.52,200,70,.52,200,70,.52,200,70,.52,200,70,.52]),this.transform.scale=v.one.multiply(.01),this.transform.position.z=-2}}class ue{constructor(){this.fixedUpdateInterval=20,this.currentLevel=1,this.state="startScreen",this.firstLevelLoaded=!1,this.initWebgl(),this.colorProgram=new g(this.gl),this.textureProgram=new x(this.gl),this.camera=new ct(this.gl,this.textureProgram),this.camera.updateProjectionMatrix(),this.textures=new ut(this.gl),this.level=new le(this.gl,this.textureProgram,this.colorProgram),this.crosshair=new ce(this.gl,this.colorProgram),this.loadLevel(this.currentLevel)}loadLevel(t){this.level.load(t,(()=>{let t=[];t.push(...this.level.enemies.map((t=>t.loot))),t.push(...this.level.enemies.map((t=>t.tempFlag))),t.push(...this.level.shapes),this.textures.load(t,(()=>{this.camera.transform.position=this.level.playerPosition,this.camera.initialTransform=this.camera.transform.clone(),this.camera.collidingShapes=[...this.level.collidingCuboids,...this.level.decorations.filter((t=>t.bb))],this.firstLevelLoaded||(this.firstLevelLoaded=!0,this.startGameLoop())}))}))}startGameLoop(){let t=0;const e=i=>{const s=(i*=.001)-t;t=i,this.draw(s),requestAnimationFrame(e)};requestAnimationFrame(e);const i=.001*this.fixedUpdateInterval;setInterval((()=>{this.fixedUpdate(i)}),this.fixedUpdateInterval)}fixedUpdate(t){if(ot.instance.interacting){const t=this.camera.nearest(this.level.interactables.filter((t=>t.canInteract)).filter((t=>{const e=this.camera.angleTo(t.transform.position);return Math.abs(e)<60})));t&&this.camera.inInteractionDistance(t)&&(t.toggle(),ot.instance.justInteracted=!0)}this.camera.update(t);for(let t of this.level.pickups.filter((t=>!t.pickedUp)))this.camera.transform.position.horizontalDistanceTo(t.transform.position)<=t.pickupRange&&t.pickUp(this.camera);for(let e of this.level.doors)e.update(t),e.opened&&e.tryToClose(t,this.camera,this.level.enemies);for(let e of this.level.secretWalls)e.update(t,this.camera);const e=yt.fromDir(this.camera.transform.position,v.fromAngle(this.camera.transform.rotation.y)).nextShape(this.level.collidingCuboids);for(let i of this.level.enemies)if(i.update(t,this.camera),this.camera.isLookingAt(i)&&e&&this.camera.transform.position.horizontalDistanceTo(i.transform.position)<this.camera.transform.position.horizontalDistanceTo(e.transform.position)&&at.instance.weapons.currentWeapon.justShot&&(this.camera.transform.position.horizontalDistanceTo(i.transform.position)<=at.instance.weapons.currentWeapon.range&&!i.isDead&&(i.damage(at.instance.weapons.currentWeapon.damage),at.instance.score+=i.score),i.isDead&&this.level.spawnLoot(i)),i.isDead)i.followingPlayer=null;else{const e=i.rotateTexture(this.camera.transform.position);if(!i.followingPlayer){let t=!1;const s=i.transform.position.horizontalDistanceTo(this.camera.transform.position);i.canSee(this.camera.transform.position,this.level.collidingCuboids)&&(at.instance.weapons.currentWeapon.justShot||Math.abs(e)<=90||s<=2*P.gridSize)&&(t=!0),t&&(i.followingPlayer=this.camera,at.instance.health>0&&i.audioSight.play(),i.state="walking")}i.tryToShoot(this.camera,this.level.collidingCuboids)||i.makeStepTowardsPlayer(t,this.level.doors),i.makeStepIfWalking(t,this.level.collidingCuboids)}0==at.instance.health&&"game"==at.instance.state&&(this.camera.audioDeath.play(),at.instance.state="dead",setTimeout((()=>{at.instance.takeLife(),this.camera.transform=this.camera.initialTransform,at.instance.state="game",this.camera.killer=null,this.loadLevel(this.currentLevel)}),4e3)),this.camera.killer&&this.camera.lookAtKillerStep(t),at.instance.update(t)}draw(t){this.setDrawSettings(),this.level.floor.draw(this.camera.viewProjectionMatrix),this.level.ceiling.draw(this.camera.viewProjectionMatrix);for(let t of this.level.pickups.filter((t=>!t.pickedUp)))t.lookAtCamera(this.camera.transform.rotation.y),t.draw(this.camera.viewProjectionMatrix);for(let t of this.level.decorations)t.lookAtCamera(this.camera.transform.rotation.y),t.draw(this.camera.viewProjectionMatrix);if(ot.instance.renderWalls){for(let t of this.level.walls)t.draw(this.camera.viewProjectionMatrix);for(let t of this.level.secretWalls)t.draw(this.camera.viewProjectionMatrix)}for(let t of this.level.exits)t.draw(this.camera.viewProjectionMatrix);for(let t of this.level.doors)t.draw(this.camera.viewProjectionMatrix);for(let t of this.level.enemies)if(t.lookAtCamera(this.camera.transform.rotation.y),t.draw(this.camera.viewProjectionMatrix),P.debug)for(let e of t.pathfinderFields)t.tempFlag.transform.position=e.subGridPos,t.tempFlag.lookAtCamera(this.camera.transform.rotation.y),t.tempFlag.draw(this.camera.viewProjectionMatrix);at.instance.draw(this.canvas)}initWebgl(){this.canvas=document.getElementById("canvas"),this.canvas.width=608*P.uiScale,this.canvas.height=304*P.uiScale,at.instance.init(),this.gl=this.canvas.getContext("webgl"),this.gl||alert("No webgl for you"),this.gl.clearColor(0,0,0,0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST)}setDrawSettings(){this.resizeCanvasToDisplaySize(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),ot.instance.update()}resizeCanvasToDisplaySize(t){const e=608*P.uiScale,i=304*P.uiScale,s=t.width!==e||t.height!==i;return s&&(t.width=e,t.height=i,this.camera.updateProjectionMatrix()),s}}window.onload=()=>{new ue}})()})();
//# sourceMappingURL=game.bundle.js.map